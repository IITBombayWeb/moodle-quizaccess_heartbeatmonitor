<html>
<!--
// This file is part of Moodle - http://moodle.org/
//
// Moodle is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// Moodle is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.

/**
 * Admin module for quizaccess_heartbeatmonitor plugin.
 *
 * @package    quizaccess
 * @subpackage heartbeatmonitor
 * @author     P Sunthar, Amrata Ramchandani <ramchandani.amrata@gmail.com>, Kashmira Nagwekar
 * @copyright  2017 IIT Bombay, India
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */ 
 -->
<head>
    <title>User Status</title>
    
    <!-- Jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
    <style>
        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 50%;
        }
        td,th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }
    </style>
</head>
<body>
    <center>
    <h1>Live status of users</h1>
    <div id='a'></div>
    <table id='livestatus'>
        <tr>
            <th> Room ID    </th>
            <th> Status     </th>
            <th> Time to consider for calculations  </th>
            <th> Total live-time    </th>
            <th> Total dead-time    </th>
        </tr>
    </table>
    </center>

    <script>
    function humanise(difference) {
        var days    = Math.floor(difference / (1000 * 60 * 60 * 24));
        var hours   = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((difference % (1000 * 60)) / 1000);
        var time    = days+' days, '+hours+' hrs, '+minutes+' mins, '+seconds+' secs' ;
        return time;
    }

    setInterval(function() {
        $.get("/livestatus", function(livestatusinfo) {
//             console.log(livestatusinfo);
            
            for(i in livestatusinfo){
                $("#livestatus").append(livestatusinfo[i].totalconnectedsockets);
                }
//                 var roomid          = livestatusinfo[i].roomid;
//                 var status          = livestatusinfo[i].status;
//                 var timetoconsider  = livestatusinfo[i].timetoconsider;
//                 var livetime        = livestatusinfo[i].livetime;
//                 var deadtime        = livestatusinfo[i].deadtime;

//                 var currentTimestamp    = new Date().getTime();
// //                 alert(humanise(currentTimestamp - timetoconsider) + ' ' + humanise(livetime) + ' ' + humanise((currentTimestamp - timetoconsider) + livetime));
//                 if (status == 'Live') {
//                     livetime = (currentTimestamp - timetoconsider) + livetime;
//                 } else {
//                     deadtime = (currentTimestamp - timetoconsider) + deadtime;
//                 }

//                 var humanisedlivetime = humanise(livetime);
//                 var humaniseddeadtime = humanise(deadtime);
   
//                 if($('#'+roomid).length > 0) {
//                     //remove prev. row and add updated row
//                     $('#'+roomid).remove();
//                     var  row = '<tr id = ' + roomid + '><td>' 
//                                     + roomid + '</td><td>'
//                                     + status + '</td><td>' 
//                                     + timetoconsider + '</td><td>' 
//                                     + humanisedlivetime + '</td><td>' 
//                                     + humaniseddeadtime + '</td></tr>';
//                     $("#livestatus").append(row);
//                 } else {
//                     //new row addition
//                     var  row = '<tr id = ' + roomid + '><td>' 
//                                     + roomid + '</td><td>' 
//                                     + status + '</td><td>' 
//                                     + timetoconsider + '</td><td>' 
//                                     + humanisedlivetime + '</td><td>' 
//                                     + humaniseddeadtime + '</td></tr>';
//                     $("#livestatus").append(row);
//                 }
//             }
        });
    }, 3000);
    </script>
</body>
</html>
